# 自动化管理功能使用说明

## 概述

自动化管理模块为星火自动化测试平台提供了完整的自动化测试流程管理功能，支持Web和游戏类型的自动化测试，具备测试代码自动生成、执行管理、状态监控等核心功能。

## 主要功能

### 1. 自动化项目管理
- **创建自动化项目**：支持Web和游戏类型的自动化测试项目
- **编辑项目配置**：可随时修改测试步骤和配置参数
- **项目状态监控**：实时查看测试执行状态
- **历史记录查看**：支持展开查看项目执行历史

### 2. 测试步骤配置
- **Web操作类型**：支持XPath元素定位和点击操作
- **Game操作类型**：支持图片识别和自动点击
- **操作次数控制**：可设置每个步骤的重复执行次数
- **时间间隔设置**：可配置步骤间的暂停时间

### 3. 测试执行管理
- **一键执行测试**：点击即可开始自动化测试
- **实时状态监控**：显示测试执行状态和进度
- **测试取消功能**：支持中途取消正在执行的测试
- **连接测试功能**：验证测试环境的连通性

### 4. 执行记录管理
- **详细执行日志**：记录每次测试的详细信息
- **状态分类显示**：测试通过、失败、取消等状态清晰展示
- **操作人记录**：记录测试执行的操作人信息
- **时间轴展示**：按时间顺序展示执行历史

## 使用流程

### 步骤1：创建自动化项目

1. **进入自动化管理页面**
   - 点击左侧导航的"自动化管理"

2. **点击"添加自动化项目"按钮**
   - 页面右上角的蓝色按钮

3. **填写基本信息**
   - **流程名称**：输入描述性的流程名称（必填）
   - **产品ID**：从下拉列表选择一个或多个产品ID（必填，同系统）
   - **系统**：选择产品ID后自动填充，也可手动选择
   - **产品类型**：自动填充或手动选择
   - **环境**：选择测试环境
   - **产品地址**：输入要测试的URL地址

### 步骤2：配置测试步骤

1. **添加测试步骤**
   - 点击"+"号添加新的测试步骤

2. **配置步骤参数**
   - **步骤名称**：为步骤设置描述性名称
   - **操作类型**：
     - **Web**：用于网页元素操作，需要提供XPath定位参数
     - **Game**：用于游戏图片识别，需要上传目标图片
   - **操作事件**：
     - **单击**：执行单次点击操作（默认）
     - **双击**：执行双击操作
   - **操作参数**：
     - Web类型：输入元素的XPath表达式
     - Game类型：上传要识别的图片文件
   - **操作次数**：设置该步骤的重复执行次数
   - **暂停时间**：设置执行前的等待时间（秒）

3. **管理测试步骤**
   - 可以添加多个测试步骤
   - 可以删除不需要的步骤
   - 步骤按添加顺序执行

### 步骤3：保存和执行

1. **保存项目**
   - 确认所有信息填写完整后点击"保存"
   - 系统会自动生成对应的Python测试代码文件

2. **执行测试**
   - 在项目列表中找到创建的项目
   - 点击"执行测试"按钮开始自动化测试
   - 按钮会变为"取消测试"，支持中途取消

3. **查看结果**
   - 测试完成后，状态会更新为相应的结果
   - 可以点击"测试日志"查看详细的执行记录

## 项目状态说明

| 状态 | 说明 | 颜色标识 |
|------|------|----------|
| 待执行 | 项目已创建但尚未执行 | 黄色 |
| 执行中 | 测试正在进行中 | 绿色 |
| 测试通过 | 测试执行成功完成 | 绿色 |
| 测试不通过 | 测试执行失败 | 红色 |
| 人工取消 | 用户手动取消测试 | 橙色 |

## 代码生成规则

### 文件命名规则
- **单个产品ID**：`{产品ID}_{系统}_{环境}.py`
- **多个产品ID**：`{产品ID}_{系统}_{环境}_{序号}.py`

### 代码结构
生成的测试代码基于项目中的`Test_Case/baidu_test.py`模板，包含：

1. **基础导入**：必要的库和模块导入
2. **测试函数**：以产品ID命名的测试函数
3. **配置参数**：网站URL和测试参数
4. **测试步骤**：按顺序生成的操作代码
5. **异常处理**：图片识别的错误处理机制

### Web操作代码示例

**单击操作：**
```python
# 测试步骤：点击按钮
time.sleep(2)
for _ in range(1):
    base_page.elem_click("//button[@id='submit']")
    time.sleep(1)
```

**双击操作：**
```python
# 测试步骤：双击按钮
time.sleep(2)
for _ in range(1):
    base_page.elem_double_click("//button[@id='submit']")
    time.sleep(1)
```

### Game操作代码示例

**单击操作：**
```python
# 测试步骤：点击游戏图片
time.sleep(3)
for _ in range(2):
    try:
        img_position = pyautogui.locateOnScreen(BASE_DIR + "/Game_Img/image.png", confidence=0.7)
        if img_position:
            center_x = img_position.left + img_position.width//2
            center_y = img_position.top + img_position.height//2
            pyautogui.moveTo(center_x, center_y)
            pyautogui.click(center_x, center_y)
        else:
            print("没有找到图片: /Game_Img/image.png")
    except Exception as e:
        print(f"图片定位失败: {e}")
    time.sleep(1)
```

**双击操作：**
```python
# 测试步骤：双击游戏图片
time.sleep(3)
for _ in range(2):
    try:
        img_position = pyautogui.locateOnScreen(BASE_DIR + "/Game_Img/image.png", confidence=0.7)
        if img_position:
            center_x = img_position.left + img_position.width//2
            center_y = img_position.top + img_position.height//2
            pyautogui.moveTo(center_x, center_y)
            pyautogui.doubleClick(center_x, center_y)
        else:
            print("没有找到图片: /Game_Img/image.png")
    except Exception as e:
        print(f"图片定位失败: {e}")
    time.sleep(1)
```

## 注意事项

### 产品ID选择
- 多选产品ID时，必须选择相同系统的产品
- 系统会自动验证所选产品的系统兼容性
- 选择后会自动填充相关的系统、类型、环境等信息

### 图片上传
- 支持 PNG、JPG、JPEG、GIF 格式
- 图片文件保存到 `Game_Img` 目录
- 建议上传清晰、特征明显的图片以提高识别准确率

### 测试执行
- 测试执行是异步进行的，不会阻塞界面操作
- 同一项目同时只能有一个测试在执行
- 测试超时时间设置为5分钟，超时会自动标记为失败

### 权限要求
- 执行游戏类型测试时需要屏幕截图权限
- 建议在无人值守环境下执行长时间测试
- 确保测试环境网络连接稳定

## 故障排除

### 常见问题

1. **产品ID选择失败**
   - 确认产品管理中已有相应的产品记录
   - 检查产品ID字段是否填写完整

2. **图片识别失败**
   - 检查上传的图片是否清晰
   - 确认图片在当前屏幕分辨率下可见
   - 调整图片识别的confidence参数（当前为0.7）

3. **测试执行失败**
   - 查看测试日志中的详细错误信息
   - 检查网络连接和目标URL的可访问性
   - 确认XPath表达式的正确性

4. **代码生成问题**
   - 检查Test_Case目录的写权限
   - 确认Python环境和依赖包正常

### 技术支持

如遇到其他问题，可以：
1. 查看浏览器控制台的错误信息
2. 检查Flask应用的日志输出
3. 验证数据库连接和表结构
4. 确认所有依赖包的版本兼容性

## 更新日志

### v1.0.0 (当前版本)
- ✅ 自动化项目的创建、编辑、删除功能
- ✅ Web和Game两种操作类型支持
- ✅ 测试代码自动生成功能
- ✅ 异步测试执行和状态监控
- ✅ 执行历史记录和日志查看
- ✅ 响应式UI设计适配
- ✅ 多产品ID支持（同系统限制）

### 后续计划
- ⏳ 测试报告生成和导出
- ⏳ 定时执行和调度功能
- ⏳ 更多操作类型支持（如键盘输入、拖拽等）
- ⏳ 测试用例模板和复用功能
- ⏳ 批量操作和项目分组管理 